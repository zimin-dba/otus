## Конфигурация стенда - 8 виртуалок Ubuntu 24 server minimal на VirtualBox

```
 Host  |       IP         |     VIP		 |        Role
 ------|------------------|-------------------------------------------
 HA1   |	192.168.1.71  |	192.168.1.70 |  HAproxy+keepalived
 HA2   |	192.168.1.72  |	192.168.1.70 |  HAproxy+keepalived
 PG1   |	192.168.1.81  |	    		 |  leader/synchronius replica
 PG2   |	192.168.1.82  |	    		 |  leader/synchronius replica
 PG3   |	192.168.1.83  |	    		 |	asynchronius replica
 ETCD1 |	192.168.1.91  |				 |
 ETCD2 |	192.168.1.92  |				 |
 ETCD3 |	192.168.1.93  |				 |
```

### **Целевое состояние:**

Две идентичные взаимозаменяемые ноды PostrgeSQL 18 - PG1 и PG2. Одна из них - лидер, другая - синхронная реплика (горячий резерв лидера). Плюс третья - асинхронная - реплика, на которую не распределяется ни нагрузка по записи, ни нагрузка по чтению: она предназначена только для снятия бэкапов (WAL-G). Связка лидер-стендбай реализована в режиме synchronius_mode=on, т.е. запись на лидера останавливается при недоступности реплики.

Виртуалки HA1 и HA2 обеспечивают: 

1. Балансировку нагрузки трафика - write-запросы идут только на лидер-ноду Patroni. Read-запросы идут как на лидера, так и на синхронную реплику.

2. Отказоустойчивость узла HAproxy+keepalived - протокол VRRP позволяет двум HA-нодам работать на одном виртуальном IP-адресе (192.168.1.70)

   
